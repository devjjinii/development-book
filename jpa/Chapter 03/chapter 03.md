### 03. 영속성 관리
* 엔티티 매니저 : 엔티티를 저장하고, 수정하고, 삭제하고, 조회하는 등 엔티티와 관련된 일을 처리한다. 
              <br>가상의 데이터베이스로 생각하면 된다.

###### 3-1 엔티티 매니저 팩토리와 엔티티 매니저
~~~
엔티티 매니저 팩토리는 여러 스레드가 동시해 접근해도 안전해서 서로 다른 스레드 간에 공유해도 되지만,
엔티티 매니저는 여러 스레드가 동시에 접근하면 동시성 문제가 발생한다.
~~~
###### 3-2 영속성 컨텍스트란?
~~~
em.persist();
persist 메소드는 저장한다. 
~~~
###### 3-3 엔티티의 생명주기
~~~
<엔티티의 4가지 상태>
*비영속
Member member = new Member();
*영속
em.persist(member);
*준영속
em.detach(member);
*삭제
em.remove(member);
~~~
###### 3-4 영속성 컨텍스트의 특징
~~~
영속 상태는 식별자 값이 반드시 있어야 한다.
JPA는 트랜잭션을 커밋하는 순간 영속성 컨텍스트에 새로 저장된 엔티티를 데이터베이스에 반영한다. : 플러시
1차캐시, 동일성 보장, 트랜잭션을 지원하는 쓰기 지연, 변경 감지, 지연 로딩 등 장점이 있다.
~~~
###### 3-5 플러시
~~~
*플러시는 영속성 컨텍스트의 변경 내용을 데이터베이스에 반영한다.
: 수정된 엔티티를 찾는다. 수정 쿼리를 만들어 쓰기 지연 SQL 저장소에 등록한다.
  쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송한다.
1.직접 호출
2.트랜잭션 커밋 시 플러시가 자동 호출
3.JPQL 쿼리 실행 시 플러시가 자동 호출

FlushModeType.AUTO : 커밋이나 쿼리를 실행할 때
FlushModeType.COMIT : 커밋할 때만
** 동기화
~~~
###### 3-6 준영속
~~~
영속 -> 준영속
영속성 컨텍스트가 관리하는 영속 상태의 엔티티가 영속성 컨텍스트에서
분리된 것을 준영속 상태라고 한다. 준영속 상태의 엔티티는 영속성 컨텍스트가 제공하는 기능을 사용할 수 없다.

1.em.detach(entity)
2.em.clear
3.em.close

<특징>
*거의 비영속 상태에 가깝다.
*식별자 값을 가지고 있다.
*지연 로딩을 할 수 없다.
~~~
